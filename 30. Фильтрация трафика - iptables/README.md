# Сценарии iptables

## Цель
Реализовать комплексную сетевую лабораторию на базе Vagrant и VirtualBox с использованием правил `iptables`, включающую:
- Port knocking для безопасного доступа по SSH;
- Маршрутизацию трафика через центральный и интернет-роутеры;
- Проброс портов с хоста;
- Доступ к веб-серверу без использования маскарадинга на конечных узлах.


## Реализация
- Использован **Vagrant + VirtualBox** (Windows 11, Vagrant 2.4.9, VirtualBox 7.2.4).
- Базовый бокс: собственный образ **`ubuntu24-noble`** (Ubuntu 24.04 LTS).
- Конфигурация выполнена **только через `Vagrantfile`** с использованием **shell-провижининга** (Ansible не используется).
- Все машины используют общую внутреннюю сеть (`internal-net`) через `virtualbox__intnet`.
- Для выхода в интернет используется NAT-интерфейс от VirtualBox с включённым **masquerading на `inetRouter`**.

## Функционал

### Сетевая топология
- **`centralRouter`** (`10.0.0.254`) — внутренний маршрутизатор.
- **`inetRouter`** (`10.0.0.2`) — основной шлюз в интернет с NAT и port knocking.
- **`inetRouter2`** (`10.0.0.3`) — дополнительный роутер с пробросом порта.
- **`centralServer`** (`10.0.0.10`) — веб-сервер.

### Port Knocking
- Доступ по SSH к `inetRouter` закрыт по умолчанию.
- Открывается только после последовательного подключения к портам: **3210 → 4321 → 5432**.
- Реализовано через модуль ядра `xt_recent` и правила `iptables`.
- Утилита `knock` установлена на `centralRouter`.
